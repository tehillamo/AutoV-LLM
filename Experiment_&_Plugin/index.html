<!DOCTYPE html>
<html>
  <head>
    <title>My experiment - Speech To Text</title>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link href="https://unpkg.com/jspsych@7.3.3/css/jspsych.css" rel="stylesheet" type="text/css" /> 
    <script src="jspsych/dist/jspsych.js"></script>
    <script src="jspsych/dist/jspsych-voice2text.js"></script>
    <script type="text/javascript" src="jspsych/dist/jspsych-calibration_voice2text.js"></script>
    <script src="jspsych/dist/plugin-html-keyboard-response.js"></script>  
</head>

<body></body>
<script>


    /* initialize jsPsych */
    var jsPsych = initJsPsych({
      on_finish: function() {
        jsPsych.data.displayData();
        jsPsych.data.get().localSave('csv','TestData.csv');
      }
    });

    /* create timeline */
    var timeline = [];

    /* blah blah 


    //var practice_trial_text = '<p style= "margin-bottom: 50px; color:red; font-size:30px">This is a practice trial</p><br><br><br>'
  


var welcome = {
    type: jsPsychHtmlKeyboardResponse,
    stimulus: "Welcome to the experiment. Press any key to begin."
  };
timeline.push(welcome);


trial_data = [];

var calibration_trial = {
    type: jsPsychcVoiceTextCalib,
    timeline: [
    {stimulus: "'my cat is sitting on the window'"}],
    prompt: "Please read the following text at loud and as clear as possible: ",
    on_finish: function(data) {
   }
  }

//timeline.push(calibration_trial);

var trial = {
    type: jsPsychcVoiceText,
    timeline: [
    {stimulus:['img/circle_blue_1.png','img/circle_green_1.png']},
    {stimulus:['img/circle_blue_2.png','img/circle_green_2.png']},
    {stimulus:['img/circle_blue_3.png','img/circle_green_3.png']},
    ],
    //choices:['r', 'g', 'b'],
    prompt: "Please click on the record button (top left) to start the recording and to uncover the circles. ",
    on_finish: function(data) {
      str = jsPsych.data.get().last(1).values()[0].stimulus[0] // provides the name of the image (e.g., "img/circle_blue_1.png")
    if(str.match(/(\d+)/)[0] == '1'){ // condition to designate the level of difficulty of the trial
      data.condition = "diff";
    } else {
      data.condition = "easy";
    }
   }
  }


  var trial_TextValidation_colour = {
    type: jsPsychcVoiceText,
    timeline: [
    {stimulus:['img/circle_blue_1.png','img/circle_green_1.png']},
    {stimulus:['img/circle_blue_2.png','img/circle_green_2.png']},
    {stimulus:['img/circle_blue_3.png','img/circle_green_3.png']},
    ],
    prompt: "Please click on the record button (top left) to start the recording and to uncover the circles. At the beginning of the trial,"+ 
    "please describe, as best as you can, the colour of the circles",
    on_finish: function(data) {
      str = jsPsych.data.get().last(1).values()[0].stimulus[0] // provides the name of the image (e.g., "img/circle_blue_1.png")
    if(str.match(/(\d+)/)[0] == '1'){ // condition to designate the level of difficulty of the trial
      data.condition = "diff";
    } else {
      data.condition = "easy";
    }
   }
  }


  var trial_TextValidation_difficulty = {
    type: jsPsychcVoiceText,
    timeline: [
    {stimulus:['img/circle_blue_1.png','img/circle_green_1.png']},
    {stimulus:['img/circle_blue_2.png','img/circle_green_2.png']},
    {stimulus:['img/circle_blue_3.png','img/circle_green_3.png']},
    ],
    prompt: "Please click on the record button (top left) to start the recording and to uncover the circles. At the beginning of the trial,"+ 
    "please describe, as best as you can, the difficulty you experienced during the trials",
    on_finish: function(data) {
      str = jsPsych.data.get().last(1).values()[0].stimulus[0] // provides the name of the image (e.g., "img/circle_blue_1.png")
    if(str.match(/(\d+)/)[0] == '1'){ // condition to designate the level of difficulty of the trial
      data.condition = "diff";
    } else {
      data.condition = "easy";
    }
   }
  }

// trial type to validate the speech to text via descriprion of the confidnecen 
  var trial_TextValidation_confidence = { 
    type: jsPsychcVoiceText,
    timeline: [
    {stimulus:['img/circle_blue_1.png','img/circle_green_1.png']},
    {stimulus:['img/circle_blue_2.png','img/circle_green_2.png']},
    {stimulus:['img/circle_blue_3.png','img/circle_green_3.png']},
    ],
    prompt: "Please click on the record button (top left) to start the recording and to uncover the circles. At the beginning of each trial,"+ 
    "please describe, as best as you can, how confidence are you during the trial and about your choice",
    on_finish: function(data) {
      str = jsPsych.data.get().last(1).values()[0].stimulus[0] // provides the name of the image (e.g., "img/circle_blue_1.png")
    if(str.match(/(\d+)/)[0] == '1'){ // condition to designate the level of difficulty of the trial
      data.condition = "diff";
    } else {
      data.condition = "easy";
    }
   }
  }

// the timeline is either for validating the text via description of the colour 
timeline_colour = [trial, trial_TextValidation_colour]
// or via description of the difficulty 
timeline_difficulty = [calibration_trial, trial, trial_TextValidation_difficulty]
// or via description of the confidence<n 
timeline_confidence = [calibration_trial, trial, trial_TextValidation_confidence]



jsPsych.run(timeline_difficulty);


function saveData(name, data){
  var xhr = new XMLHttpRequest();
  xhr.open('POST', 'write_data.php'); // 'write_data.php' is the path to the php file described above.
  xhr.setRequestHeader('Content-Type', 'application/json');
  xhr.send(JSON.stringify({filename: name, filedata: data}));
}


</script>

</html>